/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var Y=(a,s)=>{for(var t in s)x(a,t,{get:s[t],enumerable:!0})},J=(a,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of Z(s))!j.call(a,i)&&i!==t&&x(a,i,{get:()=>s[i],enumerable:!(e=Q(s,i))||e.enumerable});return a};var X=a=>J(x({},"__esModule",{value:!0}),a);var st={};Y(st,{default:()=>I});module.exports=X(st);var M=require("obsidian");var F=class{},h=class extends F{constructor(s){super(),this.unit=s,this.numberFormat=Intl.NumberFormat("en-US",{style:"decimal"})}format(s){return`${this.numberFormat.format(s)} ${this.unit}`}},N=class extends F{constructor(s){super(),this.numberFormat=s}format(s){let[t,e]=this.scale(s);return`${this.numberFormat.format(t)} ${e}`}},S=class extends N{constructor(){super(Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}))}scale(s){let t=["bytes","KB","MB","GB","TB","PB"];for(;s>=1024&&t.length>0;)s=s/1024,t.shift();return[s,t[0]]}};var H=require("obsidian"),g=class extends H.Events{constructor(){super(...arguments);this.files=0;this.notes=0;this.attachments=0;this.size=0;this.links=0;this.words=0;this.quality=1e-5;this.tags=0}reset(){this.files=0,this.notes=0,this.attachments=0,this.size=0,this.links=0,this.words=0,this.quality=1e-5,this.tags=0}dec(t){this.files-=(t==null?void 0:t.files)||0,this.notes-=(t==null?void 0:t.notes)||0,this.attachments-=(t==null?void 0:t.attachments)||0,this.size-=(t==null?void 0:t.size)||0,this.links-=(t==null?void 0:t.links)||0,this.words-=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags-=(t==null?void 0:t.tags)||0,this.trigger("updated")}inc(t){this.files+=(t==null?void 0:t.files)||0,this.notes+=(t==null?void 0:t.notes)||0,this.attachments+=(t==null?void 0:t.attachments)||0,this.size+=(t==null?void 0:t.size)||0,this.links+=(t==null?void 0:t.links)||0,this.words+=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags+=(t==null?void 0:t.tags)||0,this.trigger("updated")}on(t,e,i){return super.on("updated",e,i)}};var d=require("obsidian");var E=class{tokenize(s){return[]}},n=class n{isNonWord(s){return n.NON_WORDS.test(s)}isNumber(s){return n.NUMBER.test(s)}isCodeBlockHeader(s){return n.CODE_BLOCK_HEADER.test(s)}stripHighlights(s){let t=n.STRIP_HIGHLIGHTS.exec(s);return t?t[2]:s}stripFormatting(s){let t=n.STRIP_FORMATTING.exec(s);return t?t[2]:s}stripPunctuation(s){let t=n.STRIP_PUNCTUATION.exec(s);return t?t[2]:s}stripWikiLinks(s){let t=n.STRIP_WIKI_LINKS.exec(s);return t?t[2]:s}stripUrls(s){return s.replace(n.STRIP_URLS,"$1")}stripAll(s){let t;do t=s,s=this.stripHighlights(s),s=this.stripFormatting(s),s=this.stripPunctuation(s),s=this.stripWikiLinks(s),s=this.stripUrls(s);while(s!==t);return s}stripMarkdownLinks(s){return s.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1")}tokenize(s){return s.trim()===""?[]:(s=this.stripMarkdownLinks(s),s.split(n.WORD_BOUNDARY).filter(t=>!this.isNonWord(t)).filter(t=>!this.isNumber(t)).filter(t=>!this.isCodeBlockHeader(t)).map(t=>this.stripAll(t)).filter(t=>t.length>0))}};n.NON_WORDS=/^[^\wа-яА-ЯёЁ]+$/,n.NUMBER=/^\d+(\.\d+)?$/,n.CODE_BLOCK_HEADER=/^```\w+$/,n.STRIP_HIGHLIGHTS=/^(==)?(.*?)(==)?$/,n.STRIP_FORMATTING=/^(_+|\*+)?(.*?)(_+|\*+)?$/,n.STRIP_PUNCTUATION=/^(`|\.|:|"|,|!|\?)?(.*?)(`|\.|:|"|,|!|\?)?$/,n.STRIP_WIKI_LINKS=/^(\[\[)?(.*?)(\]\])?$/,n.STRIP_URLS=/\[.*?\]\((.*?)\)/g,n.WORD_BOUNDARY=/[ \n\r\t\"\|,\(\)\[\]/]+/;var A=n,r=new E,w=new A;function K(a){let s=/(^|[\s.,:;!?()[\]{}"'`~])#([\p{L}\p{N}_\-/\p{Emoji_Presentation}\p{Emoji}\p{S}]+)(?=[\s.,:;!?()[\]{}"'`~]|$)/gu,t=new Set,e;for(;(e=s.exec(a))!==null;)t.add("#"+e[2]);return Array.from(t)}var b=class{constructor(s){this.data=new Map;this.backlog=new Set;this.excludeDirectories=new Set;this.vaultMetrics=new g;this.cache=new Map;this.intervalId=null;this.batchSize=8;this.maxFileSize=512*1024;this.intervalMs=2e3;this.owner=s}setVault(s){return this.vault=s,this}setExcludeDirectories(s){return this.excludeDirectories=new Set(s.split(",").map(t=>t.trim()).filter(Boolean)),this}setMetadataCache(s){return this.metadataCache=s,this}setFullVaultMetrics(s){return this.vaultMetrics=s,this}start(){var s;return this.owner.registerEvent(this.vault.on("create",t=>{this.onfilecreated(t)})),this.owner.registerEvent(this.vault.on("modify",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.vault.on("delete",t=>{this.onfiledeleted(t)})),this.owner.registerEvent(this.vault.on("rename",(t,e)=>{this.onfilerenamed(t,e)})),this.owner.registerEvent(this.metadataCache.on("resolve",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.metadataCache.on("changed",t=>{this.onfilemodified(t)})),this.data.clear(),this.backlog=new Set,this.cache.clear(),(s=this.vaultMetrics)==null||s.reset(),this.vault.getFiles().forEach(t=>{t instanceof d.TFolder||this.push(t)}),this.setExcludeDirectories(this.excludeDirectories?Array.from(this.excludeDirectories).join(","):""),this.setAdaptiveInterval(),this}setAdaptiveInterval(){this.intervalId!==null&&clearInterval(this.intervalId);let s=this.backlog.size;s>100?this.intervalMs=500:s<10?this.intervalMs=5e3:this.intervalMs=2e3,this.intervalId=window.setInterval(()=>this.processBacklog(),this.intervalMs)}push(s){if(s instanceof d.TFolder)return;let t=s instanceof d.TFile?s.path:s;this.backlog.add(t),this.setAdaptiveInterval()}async processBacklog(){if(this.backlog.size===0)return;let s=Array.from(this.backlog).slice(0,this.batchSize);await Promise.allSettled(s.map(async t=>{if(t==null||t.split("/").some(i=>this.excludeDirectories.has(i))){this.backlog.delete(t);return}let e=this.vault.getAbstractFileByPath(t);if(e instanceof d.TFile)try{let i=await this.collect(e);i!=null&&this.update(t,i)}catch(i){console.log(`error processing ${t}: ${i}`)}this.backlog.delete(t)})),this.setAdaptiveInterval()}async onfilecreated(s){this.push(s)}async onfilemodified(s){this.push(s)}async onfiledeleted(s){this.push(s)}async onfilerenamed(s,t){this.push(s),this.push(t)}getFileType(s){var t;return((t=s.extension)==null?void 0:t.toLowerCase())==="md"?1:2}async collect(s){var v,f;let t=this.metadataCache.getFileCache(s);if(t===null)return null;let e=s.path,i=(f=(v=s.stat)==null?void 0:v.mtime)!=null?f:0,p=this.cache.get(e);if(p&&p.mtime===i)return p.metrics;let o;switch(this.getFileType(s)){case 1:o=await new C(this.vault,this.maxFileSize).collect(s,t);break;case 2:o=await new R().collect(s,t);break;default:o=null}return o&&this.cache.set(e,{mtime:i,metrics:o}),o}update(s,t){var i,p,o;let e=s instanceof d.TFile?s.path:s;(p=this.vaultMetrics)==null||p.dec((i=this.data.get(e))!=null?i:new g),t==null?this.data.delete(e):this.data.set(e,t),(o=this.vaultMetrics)==null||o.inc(t)}},y=class y{constructor(s,t=512*1024){this.vault=s,this.maxFileSize=t}async collect(s,t){var z,D,k,P;let e=new g;e.files=1,e.notes=1,e.attachments=0,e.size=(z=s.stat)==null?void 0:z.size,e.links=(k=(D=t==null?void 0:t.links)==null?void 0:D.length)!=null?k:0;let i=await this.vault.cachedRead(s).then(async u=>{var L;return u.length>this.maxFileSize&&(u=u.substring(0,this.maxFileSize)),(L=t.sections)==null?void 0:L.map(m=>{var $,W,_,U;let T=m.type,q=(W=($=m.position)==null?void 0:$.start)==null?void 0:W.offset,G=(U=(_=m.position)==null?void 0:_.end)==null?void 0:U.offset,O=y.TOKENIZERS.get(T);return O?O.tokenize(u.substring(q,G)).length:(console.log(`${s.path}: no tokenizer, section.type=${m.type}`),0)}).reduce((m,T)=>m+T,0)}).catch(u=>(console.log(`${s.path} ${u}`),0));e.words=i!=null?i:0,e.quality=e.notes!==0?e.links/e.notes:0;let p=await this.vault.cachedRead(s),o=K(p),v=((P=t==null?void 0:t.tags)!=null?P:[]).map(u=>typeof u=="string"?u:u.tag),f=new Set([...o,...v]);return e.tags=f.size,e}};y.TOKENIZERS=new Map([["paragraph",w],["heading",w],["list",w],["table",r],["yaml",r],["code",r],["blockquote",w],["math",r],["thematicBreak",r],["html",r],["text",r],["element",r],["footnoteDefinition",r],["definition",r],["callout",w],["comment",r]]);var C=y,R=class{async collect(s,t){var i;let e=new g;return e.files=1,e.notes=0,e.attachments=1,e.size=(i=s.stat)==null?void 0:i.size,e.links=0,e.words=0,e.quality=0,e.tags=0,e}};var l=require("obsidian"),V=class extends l.PluginSettingTab{constructor(s,t){super(s,t),this.plugin=t}display(){let{containerEl:s}=this;s.empty(),new l.Setting(s).setName("Exclude directories").setDesc("Exclude directories from statistics").addText(t=>{t.setValue(this.plugin.settings.excludeDirectories).onChange(async e=>{this.plugin.settings.excludeDirectories=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show individual items").setDesc("Whether to show multiple items at once or cycle them with a click").addToggle(t=>{t.setValue(this.plugin.settings.displayIndividualItems).onChange(async e=>{this.plugin.settings.displayIndividualItems=e,this.display(),await this.plugin.saveSettings()})}),this.plugin.settings.displayIndividualItems&&(new l.Setting(s).setName("Show notes").addToggle(t=>{t.setValue(this.plugin.settings.showNotes).onChange(async e=>{this.plugin.settings.showNotes=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show attachments").addToggle(t=>{t.setValue(this.plugin.settings.showAttachments).onChange(async e=>{this.plugin.settings.showAttachments=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show files").addToggle(t=>{t.setValue(this.plugin.settings.showFiles).onChange(async e=>{this.plugin.settings.showFiles=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show links").addToggle(t=>{t.setValue(this.plugin.settings.showLinks).onChange(async e=>{this.plugin.settings.showLinks=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show words").addToggle(t=>{t.setValue(this.plugin.settings.showWords).onChange(async e=>{this.plugin.settings.showWords=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show size").addToggle(t=>{t.setValue(this.plugin.settings.showSize).onChange(async e=>{this.plugin.settings.showSize=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show tags").addToggle(t=>{t.setValue(this.plugin.settings.showTags).onChange(async e=>{this.plugin.settings.showTags=e,await this.plugin.saveSettings()})}),new l.Setting(s).setName("Show quality").addToggle(t=>{t.setValue(this.plugin.settings.showQuality).onChange(async e=>{this.plugin.settings.showQuality=e,await this.plugin.saveSettings()})}))}};var tt={excludeDirectories:"",displayIndividualItems:!1,showNotes:!1,showAttachments:!1,showFiles:!1,showLinks:!1,showWords:!1,showSize:!1,showQuality:!1,showTags:!1},I=class extends M.Plugin{constructor(){super(...arguments);this.statusBarItem=null}async onload(){console.log("Loading vault-statistics Plugin"),await this.loadSettings(),this.vaultMetrics=new g,this.vaultMetricsCollector=new b(this).setVault(this.app.vault).setMetadataCache(this.app.metadataCache).setFullVaultMetrics(this.vaultMetrics).setExcludeDirectories(this.settings.excludeDirectories).start(),this.statusBarItem=new B(this,this.addStatusBarItem()).setFullVaultMetrics(this.vaultMetrics),this.addSettingTab(new V(this.app,this))}async loadSettings(){this.settings=Object.assign({},tt,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.statusBarItem&&this.statusBarItem.refresh()}},c=class{constructor(s){this.containerElementsForVaultFullStatistics=s.createSpan({cls:["obsidian-vault-full-statistics--item"]}),this.setActive(!1)}setStatisticName(s){return this.containerElementsForVaultFullStatistics.addClass(`obsidian-vault-full-statistics--item-${s}`),this}setFormatter(s){return this.formatter=s,this}setActive(s){return this.containerElementsForVaultFullStatistics.removeClass("obsidian-vault-full-statistics--item--active"),this.containerElementsForVaultFullStatistics.removeClass("obsidian-vault-full-statistics--item--inactive"),s?this.containerElementsForVaultFullStatistics.addClass("obsidian-vault-full-statistics--item--active"):this.containerElementsForVaultFullStatistics.addClass("obsidian-vault-full-statistics--item--inactive"),this}refresh(s){this.containerElementsForVaultFullStatistics.setText(this.formatter(s))}getText(){return this.containerElementsForVaultFullStatistics.getText()}},B=class{constructor(s,t){this.displayedStatisticIndex=0;this.statisticViews=[];this.refreshSoon=(0,M.debounce)(()=>{this.refresh()},2e3,!1);this.owner=s,this.statusBarItem=t,this.statisticViews.push(new c(this.statusBarItem).setStatisticName("notes").setFormatter(e=>new h("notes").format(e.notes))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("attachments").setFormatter(e=>new h("attachments").format(e.attachments))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("files").setFormatter(e=>new h("files").format(e.files))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("links").setFormatter(e=>new h("links").format(e.links))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("words").setFormatter(e=>new h("words").format(e.words))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("size").setFormatter(e=>new S().format(e.size))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("tags").setFormatter(e=>new h("tags").format(e.tags))),this.statisticViews.push(new c(this.statusBarItem).setStatisticName("QoV").setFormatter(e=>new h("QoV").format(e.quality))),this.statusBarItem.onClickEvent(()=>{this.onclick()})}setFullVaultMetrics(s){var t;return this.vaultMetrics=s,this.owner.registerEvent((t=this.vaultMetrics)==null?void 0:t.on("updated",this.refreshSoon)),this.refreshSoon(),this}refresh(){this.owner.settings.displayIndividualItems?(this.statisticViews[0].setActive(this.owner.settings.showNotes).refresh(this.vaultMetrics),this.statisticViews[1].setActive(this.owner.settings.showAttachments).refresh(this.vaultMetrics),this.statisticViews[2].setActive(this.owner.settings.showFiles).refresh(this.vaultMetrics),this.statisticViews[3].setActive(this.owner.settings.showLinks).refresh(this.vaultMetrics),this.statisticViews[4].setActive(this.owner.settings.showWords).refresh(this.vaultMetrics),this.statisticViews[5].setActive(this.owner.settings.showSize).refresh(this.vaultMetrics),this.statisticViews[6].setActive(this.owner.settings.showTags).refresh(this.vaultMetrics),this.statisticViews[7].setActive(this.owner.settings.showQuality).refresh(this.vaultMetrics)):this.statisticViews.forEach((s,t)=>{s.setActive(this.displayedStatisticIndex==t).refresh(this.vaultMetrics)}),this.statusBarItem.title=this.statisticViews.map(s=>s.getText()).join(`
`)}onclick(){this.owner.settings.displayIndividualItems||(this.displayedStatisticIndex=(this.displayedStatisticIndex+1)%this.statisticViews.length),this.refresh()}};

/* nosourcemap */